# Поиск накладных по IMAP (Streamlit)

## Описание проекта

Приложение подключается к почтовому ящику по IMAP (через настройки в `st.secrets`), ищет письма от `robot_volgorost@volgorost.ru` за заданный период, извлекает номера накладных из текста вида:

```
Пользователь: … провел документ: Приходная накл. <номер> (дата)
```

и формирует отчёт в формате `.xls` для скачивания. В отчёте отображаются номера накладных и даты из писем.

## Требования

- Python 3

## Установка зависимостей

```bash
pip install -r requirements.txt
```

## Настройка доступа к почте (через st.secrets)

Все настройки доступа берутся **только** из `st.secrets` — это рекомендуемый вариант для продакшена.

Создайте файл `.streamlit/secrets.toml` со следующей секцией:

```toml
[email]
IMAP_HOST = "imap.example.com"
IMAP_PORT = 993
EMAIL_USER = "user@example.com"
EMAIL_PASSWORD = "app-password-or-password"
```

Локально `secrets.toml` обычно размещается в папке `.streamlit` рядом с `app.py`. В Streamlit Cloud значения задаются через интерфейс проекта (Secrets).

## Запуск приложения

1. Клонировать репозиторий или скачать файлы.
2. Установить зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Настроить `st.secrets` (файл `secrets.toml` с секцией `[email]`).
4. Убедиться, что IMAP включён в почтовом сервисе.
5. Запустить:

   ```bash
   streamlit run app.py
   ```

6. Открыть ссылку вида: http://localhost:8501.

## Использование

1. Откройте приложение в браузере.
2. Выберите дату начала и окончания периода.
3. Нажмите кнопку **Запустить поиск**.
4. Дождитесь результата:
   - Просмотрите найденные накладные, даты и пользователей в таблице.
   - Нажмите **Скачать XLS** для выгрузки отчёта (колонки: накладная, пользователь).

## Логи

Приложение пишет логи в файл `app.log` в корне проекта. В логах фиксируются:

- Подключение к IMAP.
- Найденные письма и накладные.
- Ошибки.

Логи помогут диагностировать проблемы соединения или изменения в формате писем.

## Ограничения и нюансы

- Приложение ориентируется на формат текста: `Приходная накл. <номер> (дата)`.
- Если формат писем изменится, потребуется адаптировать регулярное выражение в коде.
- Ищутся только письма от указанного отправителя за выбранный период.
